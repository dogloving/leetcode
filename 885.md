```CPP
class Solution {
public:
    vector<vector<int>> spiralMatrixIII(int R, int C, int r0, int c0) {
        vector<vector<bool>> passed(R, vector<bool>(C, false));
        vector<vector<int>> res;
        int dir = 3; // 0:right 1:down 2:left 3:up
        int cnt = 0; // number of passed
        while (cnt < R*C) {
            if ((r0 >= 0 && r0 < R && c0 >= 0 && c0 < C) && !passed[r0][c0]) {
                res.push_back({r0, c0});
                ++cnt;
                passed[r0][c0] = true;
				if (dir == 0 && r0 + 1 < R && passed[r0+1][c0]);
				else if (dir == 1 && c0 - 1 >= 0 && passed[r0][c0-1]);
				else if (dir == 2 && r0 - 1 >= 0 && passed[r0-1][c0]);
				else if (dir == 3 && c0 + 1 < C && passed[r0][c0+1]);
				else dir = (dir + 1) % 4;
			} else if (dir == 0) {
				if (c0 + 1 == C + 1) dir = (dir + 1) % 4;
				else if (r0 == -1 && (c0 == C || !passed[r0+1][c0])) dir = (dir + 1) % 4;
			} else if (dir == 1) {
				if (r0 + 1 == R + 1) dir = (dir + 1) % 4;
				else if (c0 == C && (r0 == R || !passed[r0][c0-1])) dir = (dir + 1) % 4;
			} else if (dir == 2) {
				if (c0 - 1 == -2) dir = (dir + 1) % 4;
				else if (r0 == R && (c0 == -1 || !passed[r0-1][c0])) dir = (dir + 1) % 4;
			} else if (dir == 3) {
				if (r0 - 1 == -2) dir = (dir + 1) % 4;
				else if (c0 == -1 && (r0 == -1 || !passed[r0][c0+1])) dir = (dir + 1) % 4;
			}
            if (dir == 0) ++c0;
            else if (dir == 1) ++r0;
            else if (dir == 2) --c0;
            else --r0;
        }
        return res;
    }
};
```
